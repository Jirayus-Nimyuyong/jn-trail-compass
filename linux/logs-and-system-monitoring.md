# การใช้ Logs และ System Monitoring ใน Linux

## บทนำ

การตรวจสอบ **Logs** และ **System Monitoring** เป็นส่วนสำคัญในการดูแลและบำรุงรักษาระบบ Linux โดยการตรวจสอบ log files จะช่วยให้เราทราบถึงปัญหาหรือเหตุการณ์ที่เกิดขึ้นในระบบ เช่น การเข้าสู่ระบบที่ไม่ถูกต้อง, กระบวนการที่ล้มเหลว, หรือการใช้ทรัพยากรสูงผิดปกติ

ในบทนี้, เราจะเรียนรู้เกี่ยวกับการใช้ **log files** และเครื่องมือ **system monitoring** ในการตรวจสอบสถานะและประสิทธิภาพของระบบ

## 1. การใช้ Logs ใน Linux

### 1.1 ไฟล์ Log ที่สำคัญ

ในระบบ Linux, การเก็บข้อมูลเกี่ยวกับการทำงานของระบบจะถูกบันทึกไว้ในไฟล์ **log** ซึ่งมีหลายไฟล์ที่สำคัญ:

- `/var/log/syslog` หรือ `/var/log/messages`: บันทึกข้อความทั่วไปเกี่ยวกับระบบ
- `/var/log/auth.log`: บันทึกการเข้าสู่ระบบและการตรวจสอบการเข้าถึง
- `/var/log/kern.log`: บันทึกข้อความเกี่ยวกับการทำงานของเคอร์เนล
- `/var/log/cron`: บันทึกการทำงานของ cron jobs
- `/var/log/dmesg`: บันทึกข้อมูลเกี่ยวกับการบูตระบบและ hardware
- `/var/log/boot.log`: บันทึกการเริ่มต้นระบบ

### 1.2 การดู Log Files

สามารถใช้คำสั่ง `cat`, `less`, หรือ `tail` เพื่อดูไฟล์ log:

- **ดูไฟล์ log ด้วย `cat`**:
  ```bash
  cat /var/log/syslog
  ```
  
- **ดูไฟล์ log ด้วย `less` (เพื่อเลื่อนดู)**:
  ```bash
  less /var/log/syslog
  ```

- **ดูไฟล์ log ล่าสุดด้วย `tail`**:
  ```bash
  tail -f /var/log/syslog
  ```

คำสั่ง `tail -f` จะช่วยให้คุณดู log ที่เพิ่มเข้ามาใหม่ในเวลา real-time

### 1.3 การค้นหาใน Log Files

คุณสามารถใช้คำสั่ง `grep` เพื่อค้นหาคำหรือข้อความในไฟล์ log:

```bash
grep "error" /var/log/syslog
```

คำสั่งนี้จะค้นหาข้อความที่มีคำว่า "error" ในไฟล์ `/var/log/syslog`

### 1.4 การจัดการ Log Files

การจัดการ log files เช่น การหมุนเวียนไฟล์ log (log rotation) สามารถทำได้โดยใช้เครื่องมือ **logrotate**:

- การตั้งค่า logrotate สำหรับไฟล์ log สามารถแก้ไขได้ในไฟล์ `/etc/logrotate.conf` หรือ `/etc/logrotate.d/`

ตัวอย่างการตั้งค่าการหมุนเวียน log:

```bash
/var/log/syslog {
    weekly
    rotate 4
    compress
    missingok
    notifempty
}
```

ในตัวอย่างนี้, ไฟล์ `/var/log/syslog` จะถูกหมุนเวียนทุกสัปดาห์ โดยเก็บไฟล์ log ไว้ 4 เวอร์ชัน และจะบีบอัดไฟล์ log เก่าที่ไม่ใช้งาน

## 2. การใช้ System Monitoring ใน Linux

### 2.1 เครื่องมือที่ใช้ในการ Monitor ระบบ

มีหลายเครื่องมือที่ใช้ในการตรวจสอบสถานะและประสิทธิภาพของระบบใน Linux:

#### 2.1.1 `top` หรือ `htop`

**`top`** เป็นเครื่องมือที่ใช้ในการตรวจสอบการใช้ทรัพยากรของระบบ เช่น CPU, RAM, การใช้งานพอร์ตต่างๆ และกระบวนการที่กำลังทำงานอยู่:

```bash
top
```

**`htop`** เป็นเวอร์ชันที่มีกราฟิกและใช้งานง่ายกว่า:

```bash
htop
```

### 2.2 การตรวจสอบการใช้งาน CPU

คุณสามารถใช้คำสั่ง `mpstat` เพื่อดูการใช้งาน CPU:

```bash
mpstat -P ALL 1
```

คำสั่งนี้จะแสดงการใช้งาน CPU ทุกๆ 1 วินาที

### 2.3 การตรวจสอบการใช้งานหน่วยความจำ (Memory)

ใช้คำสั่ง `free` เพื่อตรวจสอบการใช้งานหน่วยความจำในระบบ:

```bash
free -h
```

คำสั่งนี้จะให้ข้อมูลเกี่ยวกับ RAM และ swap memory ที่ถูกใช้งาน

### 2.4 การตรวจสอบการใช้งาน Disk

คุณสามารถใช้คำสั่ง `df` เพื่อตรวจสอบการใช้งานดิสก์:

```bash
df -h
```

คำสั่งนี้จะแสดงพื้นที่ดิสก์ที่ใช้งาน, พื้นที่ที่ว่าง, และพื้นที่ทั้งหมดในระบบ

### 2.5 การตรวจสอบประสิทธิภาพของระบบ

ใช้คำสั่ง `vmstat` เพื่อตรวจสอบข้อมูลทางระบบเช่น การใช้ CPU, การแลกเปลี่ยนข้อมูล (swap), และหน่วยความจำ

```bash
vmstat 1
```

คำสั่งนี้จะแสดงข้อมูลทางระบบทุกๆ 1 วินาที

## 3. การตั้งค่า System Monitoring ด้วยเครื่องมืออื่นๆ

### 3.1 การติดตั้งและใช้งาน **Nagios**

**Nagios** เป็นเครื่องมือที่ใช้ในการตรวจสอบสถานะของระบบ, เซิร์ฟเวอร์, และอุปกรณ์ต่างๆ:

- ติดตั้ง Nagios:
  ```bash
  sudo apt-get install nagios3
  ```

- Nagios สามารถตั้งค่าให้ตรวจสอบสถานะของเซิร์ฟเวอร์, บริการ, และระบบในรูปแบบต่างๆ เช่น HTTP, FTP, หรือการใช้งาน CPU

### 3.2 การติดตั้งและใช้งาน **Prometheus และ Grafana**

**Prometheus** เป็นเครื่องมือที่ใช้ในการเก็บข้อมูลและตรวจสอบการใช้งานระบบในระยะยาว:

- ติดตั้ง Prometheus:
  ```bash
  sudo apt-get install prometheus
  ```

- **Grafana** เป็นเครื่องมือที่ใช้ในการแสดงผลข้อมูลที่เก็บจาก Prometheus ในรูปแบบของกราฟและแดชบอร์ด

### 3.3 การตั้งค่าการแจ้งเตือน (Alerting)

ทั้ง Nagios, Prometheus, และเครื่องมือ monitoring อื่นๆ สามารถตั้งค่าการแจ้งเตือนเมื่อเกิดเหตุการณ์ที่ผิดปกติ เช่น การใช้งาน CPU สูง, หรือเซิร์ฟเวอร์ล่ม

## 4. สรุป

การใช้ **Logs** และ **System Monitoring** เป็นเครื่องมือที่สำคัญในการบำรุงรักษาระบบ Linux ช่วยให้เราตรวจสอบและจัดการสถานะของระบบได้อย่างมีประสิทธิภาพ การใช้เครื่องมือต่างๆ เช่น `top`, `df`, `free`, และ `htop` ช่วยให้เราทราบถึงทรัพยากรของระบบที่กำลังใช้งานอยู่ ขณะที่การใช้ `logrotate` และการตรวจสอบ log files จะช่วยให้ระบบของเราทำงานได้อย่างราบรื่นและมีประสิทธิภาพ